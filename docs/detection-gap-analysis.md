# Detection Gap Analysis â€“ PowerShell Abuse

## Scenario Description
A PowerShell command was executed on a Windows 11 endpoint using non-interactive and hidden execution parameters:
- NoProfile
- WindowStyle Hidden

The command performed local user enumeration.

## Expected Detection
Given the use of hidden PowerShell execution, an alert related to:
- Suspicious PowerShell usage
- Living-off-the-Land techniques
- Defense Evasion

was expected.

## Observed Result
No high-severity alert or specific PowerShell abuse detection was generated by Wazuh.
Only generic Windows logon and system policy alerts were observed.

## Impact
An attacker using PowerShell in this manner could perform reconnaissance without triggering meaningful alerts, increasing dwell time.

## Root Cause Confirmation
PowerShell Script Block Logging (Event ID 4104) is successfully generated and visible in the local Windows Event Viewer under:
Microsoft-Windows-PowerShell/Operational.

However, these events are not ingested by Wazuh, confirming that the detection gap is caused by missing event channel collection rather than endpoint logging misconfiguration.

## Recommendation
- Enable PowerShell Script Block Logging on Windows endpoints.
- Create or tune Wazuh rules to alert on PowerShell execution with evasion-related flags.
- Map detection to MITRE ATT&CK T1059.001 (PowerShell).

## SOC Relevance
This gap highlights the importance of continuous detection tuning and validates the need for proactive threat hunting in SOC operations.

## Resolution Outcome
After configuring the Wazuh agent to collect the Microsoft-Windows-PowerShell/Operational event channel, PowerShell Script Block events (Event ID 4104) became visible in Wazuh.

Subsequent PowerShell execution generated a detection mapped to MITRE ATT&CK T1082 (System Information Discovery), confirming successful visibility and detection of PowerShell-based discovery activity.

